<app-titulo-principal titulo="Generar formato de actividades"></app-titulo-principal>

<div class="border-panel panel-custom">
  <h1 class="subtitulo-base-lg">INFORME DE PROMOCIÓN Y DIFUSIÓN</h1>
</div>

<div class="border-panel">
  <form [formGroup]="agregarGenerarFormatoActividadesForm">
    <div class="row mb-3">
      <div class="col-md-6">
        <label class="control-label" for="folio">Folio de formato:</label>
        <input id="folio" class="form-control" formControlName="folio" placeholder="">
      </div>
      <div class="col-md-6">
        <label class="control-label" for="velatorio">Velatorio<span class="req">*</span>:</label>
        <p-dropdown id="velatorio" class="form-control" formControlName="velatorio" [options]="catalogoVelatorios"
          placeholder="Selecciona el velatorio" (onChange)="consultarPromotores()">
        </p-dropdown>
        <span class="campo-obligatorio"
          *ngIf="apf.velatorio?.errors?.required && (apf.velatorio?.dirty || apf.velatorio?.touched)">Este campo es
          obligatorio *.</span>
      </div>
    </div>

    <div class="row mb-3">
      <div class="col-md-12">
        <label class="control-label" for="fechaInicio">Periodo*:</label>
      </div>
      <div class="col-md-6">
        <p-calendar styleClass="form-control" id="fechaInicio" formControlName="fechaInicio" [showIcon]="true"
          dateFormat="dd/mm/yy" placeholder="Fecha inicial"></p-calendar>
      </div>
      <div class="col-md-6">
        <p-calendar styleClass="form-control" id="fechaFinal" formControlName="fechaFinal" [showIcon]="true"
          dateFormat="dd/mm/yy" placeholder="Fecha final" [maxDate]="fechaActual"></p-calendar>
      </div>
    </div>

    <div class="row mt-6" *appValidaRol="['PROMOTORES','CONSULTA']">
      <div class="col-md-12 flex justify-content-end">
        <button type="button" class="btn btn-primary btn-md ml-5" (click)="agregarRegistro();">Agregar</button>
      </div>
    </div>
  </form>

</div>

<section class="mt-5">

  <p-table styleClass="mt-5" [value]="actividades" dataKey="idActividad" editMode="row"
    [paginator]="actividades.length > 0" [rows]="cantElementosPorPagina" [lazy]="true" [totalRecords]="totalElementos"
    [pageLinks]="3" [(first)]="numPaginaActual" (onLazyLoad)="paginar($event)"
    [tableStyle]="{'min-width': '50rem', 'border-bottom': '2px solid #484848'}">
    <ng-template pTemplate="header">
      <tr>
        <th id="fecha" style="width:8%" rowspan="2">Fecha</th>
        <th id="horario" colspan="2">Horario*</th>
        <th id="personal" colspan="2">Personal del velatorio*</th>
        <th id="numero" style="width:5%" rowspan="2">Número de pláticas*</th>
        <th id="sede" colspan="3">Sede*</th>
        <th id="observaciones" style="width:10%" rowspan="2">Observaciones</th>
        <th id="evidencia" style="width:5%" rowspan="2">Evidencia</th>
        <th id="acciones" style="width:5%" rowspan="2">Acciones</th>
      </tr>
      <tr>
        <th id="hora-inicial" style="width:7%">Hora inicio</th>
        <th id="hora-termino" style="width:7%">Hora término</th>
        <th id="personal">Personal velatorio</th>
        <th id="puesto">Puesto</th>
        <th id="unidad">Unidad IMSS</th>
        <th id="empresa">Empresa</th>
        <th id="actividad">Actividad realizada</th>
      </tr>
    </ng-template>
    <ng-template pTemplate="body" let-actividad let-editing="editing" let-ri="rowIndex">
      <tr [pEditableRow]="actividad">
        <td>
          <p-cellEditor>
            <ng-template pTemplate="input">
              <p-calendar styleClass="form-control" appendTo="body" id="fechaInicio" [(ngModel)]="actividad.fecha"
                [showIcon]="false" dateFormat="dd/mm/yy" placeholder=""></p-calendar>
            </ng-template>
            <ng-template pTemplate="output">
              {{actividad.fecha}}
            </ng-template>
          </p-cellEditor>
        </td>
        <td>
          <p-cellEditor>
            <ng-template pTemplate="input">
              <p-calendar styleClass="form-control" appendTo="body" [(ngModel)]="actividad.horarioInicial"
                [showIcon]="false" placeholder="00:00" [timeOnly]="true"></p-calendar>
            </ng-template>
            <ng-template pTemplate="output">
              {{actividad.horarioInicial}}
            </ng-template>
          </p-cellEditor>
        </td>
        <td>
          <p-cellEditor>
            <ng-template pTemplate="input">
              <p-calendar styleClass="form-control" appendTo="body" [(ngModel)]="actividad.horarioFinal"
                [showIcon]="false" placeholder="00:00" [timeOnly]="true"></p-calendar>
            </ng-template>
            <ng-template pTemplate="output">
              {{actividad.horarioFinal}}
            </ng-template>
          </p-cellEditor>
        </td>
        <td>
          <p-cellEditor>
            <ng-template pTemplate="input">
              <p-dropdown id="promotor" class="form-control" appendTo="body" [(ngModel)]="actividad.personalVelatorio"
                [options]="catalogoPromotores" placeholder="" [filter]="true">
              </p-dropdown>
            </ng-template>
            <ng-template pTemplate="output">
              {{actividad.personalVelatorio}}
            </ng-template>
          </p-cellEditor>
        </td>
        <td>
          <p-cellEditor>
            <ng-template pTemplate="input">
              <input pInputText type="text" style="width:100%" [value]="actividad.puesto" [disabled]="true">
            </ng-template>
            <ng-template pTemplate="output">
              {{actividad.puesto}}
            </ng-template>
          </p-cellEditor>
        </td>
        <td>
          <p-cellEditor>
            <ng-template pTemplate="input">
              <input pInputText type="number" style="width:100%" [(ngModel)]="actividad.numPlaticas" maxlength="2">
            </ng-template>
            <ng-template pTemplate="output">
              {{actividad.numPlaticas}}
            </ng-template>
          </p-cellEditor>
        </td>
        <td>
          <p-cellEditor>
            <ng-template pTemplate="input">
              <input pInputText type="text" style="width:100%" [(ngModel)]="actividad.unidadImss" maxlength="30">
            </ng-template>
            <ng-template pTemplate="output">
              {{actividad.unidadImss}}
            </ng-template>
          </p-cellEditor>
        </td>
        <td>
          <p-cellEditor>
            <ng-template pTemplate="input">
              <input pInputText type="text" style="width:100%" [(ngModel)]="actividad.empresa" maxlength="30">
            </ng-template>
            <ng-template pTemplate="output">
              {{actividad.empresa}}
            </ng-template>
          </p-cellEditor>
        </td>
        <td>
          <p-cellEditor>
            <ng-template pTemplate="input">
              <input pInputText type="text" style="width:100%" [(ngModel)]="actividad.actividadRealizada"
                maxlength="20">
            </ng-template>
            <ng-template pTemplate="output">
              {{actividad.actividadRealizada}}
            </ng-template>
          </p-cellEditor>
        </td>
        <td>
          <p-cellEditor>
            <ng-template pTemplate="input">
              <input pInputText type="text" style="width:100%" [(ngModel)]="actividad.observaciones" maxlength="50">
            </ng-template>
            <ng-template pTemplate="output">
              {{actividad.observaciones}}
            </ng-template>
          </p-cellEditor>
        </td>
        <td>
          <p-cellEditor>
            <ng-template pTemplate="input">
              <div class="contenedor-inputswitch">
                <p-inputSwitch [(ngModel)]="actividad.evidencia"></p-inputSwitch>
                <span class="activo" *ngIf="actividad.evidencia">Si</span>
                <span class="inactivo" *ngIf="!actividad.evidencia">No</span>
              </div>
            </ng-template>
            <ng-template pTemplate="output">
              {{actividad.evidencia ? 'Si' : 'No'}}
            </ng-template>
          </p-cellEditor>
        </td>
        <td>
          <div class="flex align-items-center justify-content-center gap-2">
            <a [id]='actividad.idActividad' class="btn-actions" *ngIf="!editing" pRipple pInitEditableRow
              (click)="onRowEditInit(actividad)">
              <img src="assets/images/imagen-icono-pencil-modificar.svg" alt="Editar">
            </a>
            <a class="btn-actions" *ngIf="!editing" pRipple pDeleteEditableRow (click)="onRowDelete(actividad)">
              <img src="assets/images/imagen-icono-eliminar.svg" alt="Eliminar">
            </a>
            <a class="btn-actions" *ngIf="editing" pRipple pSaveEditableRow (click)="onRowEditSave(actividad)">
              <img src="assets/images/imagen-icono-guardar.svg" alt="Guardar">
            </a>
            <button class="btn-actions" *ngIf="editing" pButton pRipple type="button" pCancelEditableRow
              icon="pi pi-times" (click)="onRowEditCancel(actividad, ri)"
              class="p-button-rounded p-button-text p-button-danger">
            </button>
          </div>
        </td>
      </tr>
    </ng-template>
    <ng-template pTemplate="paginatorleft">
      <div class="paginator-template">
        <span class="total-elements">{{actividades.length}} de {{totalElementos}}</span>
      </div>
    </ng-template>
    <ng-template pTemplate="paginatorright">
    </ng-template>
  </p-table>


  <div class="flex justify-content-between">
    <span class="mensaje-inferior-campo-obligatorio">*Campos obligatorios</span>
    <span class="subtitulo fs-2x">Número de pláticas al mes: {{actividades.length}}</span>
  </div>

  <div class="flex justify-content-end mt-6 mb-6">
    <button class="btn btn-gold btn-md" [routerLink]="'../../'">Cancelar</button>
    <button type="button" class="ml-4 btn btn-primary btn-md">
      Generar formato
    </button>
  </div>
</section>

<p-dialog [(visible)]="mostrarModalPromotorDuplicado" [modal]="true" [style]="{maxWidth:'544px',width: '100%'}"
  [draggable]="false" [resizable]="false" header="">
  <ng-template pTemplate="content">
    <div class="flex flex-column align-items-center justify-content-center">
      <span class="text-justify">{{mensajeModal}}</span>
    </div>
  </ng-template>
  <ng-template pTemplate="footer">
    <div class="flex justify-content-center">
      <button class="btn btn-primary btn-md" (click)="mostrarModalPromotorDuplicado = false">Aceptar</button>
    </div>
  </ng-template>
</p-dialog>