<div class="grid">
  <app-btn-regresar class="mr-2 mt-5 col-fixed border-return-button" routerLink="./../../.."></app-btn-regresar>
  <app-titulo-principal *ngIf="tipoConvenio !== '1'"
                        titulo="Pre-registro para la contratación de Convenio de Previsión Funeraria"
                        class="col"></app-titulo-principal>
  <app-titulo-principal *ngIf="tipoConvenio === '1'"
                        titulo="Pre-registro para la contratación de Plan de Servicios Funerarios"
                        class="col"></app-titulo-principal>
</div>
<app-convenio-header [tipoContratacion]="tipoConvenio === '2' ? 'Por empresa' :  'Por Persona'"
                     [numeroFolio]="folio"></app-convenio-header>
<ng-container [ngSwitch]="tipoConvenio">
  <ng-container *ngSwitchCase="'1'">
    <form [formGroup]="contratacionNuevoConvenioForm">
      <p-accordion styleClass="sivimss-accordion sivimss-accordionColor mb-5" [activeIndex]="0">
        <p-accordionTab header="Datos del titular">
          <div formGroupName="titular">
            <app-datos-titular-beneficiario></app-datos-titular-beneficiario>
          </div>
        </p-accordionTab>
      </p-accordion>
      <p-accordion styleClass="sivimss-accordion sivimss-accordionColor mb-5" [activeIndex]="0">
        <p-accordionTab header="Datos del titular sustituto">
          <label class="control-label">Son los mismos que el titular</label>
          <div class="flex">
            <div class="flex align-items-center mx-2">
              <p-radioButton [inputId]="'titularSi'" name="titular" [value]="true"
                             [(ngModel)]="mismoSustituto" [ngModelOptions]="{standalone: true}"
                             (ngModelChange)="modificarSustituto()"></p-radioButton>
              <label class="control-label m-0 mx-3" [for]="'titularSi'">Sí</label>
            </div>
            <div class="flex align-items-center mx-2">
              <p-radioButton [inputId]="'titularNo'" name="titular" [value]="false"
                             [(ngModel)]="mismoSustituto" [ngModelOptions]="{standalone: true}"
                             (ngModelChange)="modificarSustituto()"></p-radioButton>
              <label class="control-label m-0 mx-3" [for]="'titularNo'">No</label>
            </div>
          </div>
          <div formGroupName="sustituto" class="mt-3">
            <app-datos-sustituto-beneficiario></app-datos-sustituto-beneficiario>
          </div>
        </p-accordionTab>
      </p-accordion>
      <p-accordion styleClass="sivimss-accordion sivimss-accordionColor mb-5" [activeIndex]="0">
        <p-accordionTab header="Datos del beneficiario 1">
          <div formGroupName="beneficiario1" *ngIf="titularPA.beneficiario1 else SinBeneficiarioEspecifico">
            <app-datos-sustituto-beneficiario [id]="'beneficiario1'" [tipo]="'beneficiario'">
            </app-datos-sustituto-beneficiario>
          </div>
        </p-accordionTab>
      </p-accordion>
      <p-accordion styleClass="sivimss-accordion sivimss-accordionColor mb-5" [activeIndex]="0">
        <p-accordionTab header="Datos del beneficiario 2">
          <div formGroupName="beneficiario2" *ngIf="titularPA.beneficiario2 else SinBeneficiarioEspecifico">
            <app-datos-sustituto-beneficiario [id]="'beneficiario2'" [tipo]="'beneficiario'">
            </app-datos-sustituto-beneficiario>
          </div>
        </p-accordionTab>
      </p-accordion>
      <p-accordion styleClass="sivimss-accordion mt-3" [activeIndex]="0">
        <p-accordionTab>
          <ng-template pTemplate="header">
            <div class="flex justify-content-between align-items-center flex-1">
              <span>Promotor</span>
            </div>
          </ng-template>
          <ng-template pTemplate="content">
            <label class="control-label">¿El servicio fue gestionado por un promotor? *</label>
            <div class="flex">
              <div class="flex align-items-center mx-2">
                <p-radioButton [inputId]="'promotorSi'" name="promotor" [value]="true"
                               [(ngModel)]="promotor" [ngModelOptions]="{standalone: true}">>
                </p-radioButton>
                <label class="control-label m-0 mx-3" [for]="'promotorSi'">Sí</label>
              </div>
              <div class="flex align-items-center mx-2">
                <p-radioButton [inputId]="'promotorNo'" name="promotor" [value]="false"
                               [(ngModel)]="promotor" [ngModelOptions]="{standalone: true}">>
                </p-radioButton>
                <label class="control-label m-0 mx-3" [for]="'promotorNo'">No</label>
              </div>
            </div>
          </ng-template>
        </p-accordionTab>
      </p-accordion>
    </form>
  </ng-container>
  <ng-container *ngSwitchCase="'2'">
    <form [formGroup]="contratacionNuevoConvenioForm">
      <p-accordion styleClass="sivimss-accordion sivimss-accordionColor mb-5" [activeIndex]="0">
        <p-accordionTab header="Grupo o empresa">
          <div formGroupName="empresa">
            <app-datos-empresa></app-datos-empresa>
          </div>
        </p-accordionTab>
      </p-accordion>
      <p-accordion styleClass="sivimss-accordion mt-3">
        <p-accordionTab>
          <ng-template pTemplate="header">
            <div class="flex justify-content-between align-items-center flex-1">
              <span>Solicitantes del Grupo o Empresa</span>
            </div>
          </ng-template>
          <ng-template pTemplate="content">
            <ng-container formArrayName="solicitantes">
              <ng-container *ngIf="solicitantes.length > 0 else SinSolicitantes">
                <ng-container *ngFor="let persona of solicitantesEmpresa.controls; let i = index">
                  <p-accordion styleClass="sivimss-accordion sivimss-accordionColor mb-5">
                    <p-accordionTab [header]="persona.get('nombres')?.value" [formGroupName]="i">
                      <ng-template pTemplate="content">
                        <app-datos-persona [enfermedad]="false" [ID]="i.toString()"></app-datos-persona>
                        <p-accordion styleClass="sivimss-accordion sivimss-accordionColor mb-5" [activeIndex]="0">
                          <p-accordionTab header="Documentación requerida">
                            <ng-container *ngIf="false else ErrorDocumentacion">
                              <app-documentacion-beneficiario></app-documentacion-beneficiario>
                            </ng-container>
                          </p-accordionTab>
                        </p-accordion>
                        <p-accordion styleClass="sivimss-accordion sivimss-accordionColor mb-5" [activeIndex]="0">
                          <p-accordionTab>
                            <ng-template pTemplate="header">
                              <div class="flex justify-content-between align-items-center flex-1">
                                <span>Beneficiarios</span>
                              </div>
                            </ng-template>
                            <ng-template pTemplate="content">
                              <ng-container formArrayName="beneficiarios">
                                <ng-container *ngIf="solicitantes[i].beneficiarios && solicitantes[i].beneficiarios!.length > 0
                              else SolicitanteSinBeneficiarios">
                                  <ng-container
                                    *ngFor="let beneficiario of getFormBeneficiarios(persona).controls; let j = index">
                                    <p-accordion styleClass="sivimss-accordion sivimss-accordionColor mb-5">
                                      <p-accordionTab [header]="beneficiario.get('nombre')?.value" [formGroupName]="j">
                                        <ng-template pTemplate="content">
                                          <app-datos-beneficiario></app-datos-beneficiario>
                                          <p-accordion styleClass="sivimss-accordion sivimss-accordionColor mb-5" [activeIndex]="0">
                                            <p-accordionTab header="Documentación requerida">
                                              <ng-container *ngIf="false else ErrorDocumentacion">
                                                <app-documentacion-beneficiario></app-documentacion-beneficiario>
                                              </ng-container>
                                            </p-accordionTab>
                                          </p-accordion>
                                        </ng-template>
                                      </p-accordionTab>
                                    </p-accordion>
                                  </ng-container>
                                </ng-container>
                              </ng-container>
                            </ng-template>
                          </p-accordionTab>
                        </p-accordion>
                      </ng-template>
                    </p-accordionTab>
                  </p-accordion>
                </ng-container>
              </ng-container>
            </ng-container>
          </ng-template>
        </p-accordionTab>
      </p-accordion>
    </form>
  </ng-container>

  <ng-container *ngSwitchCase="'3'">
    <form [formGroup]="contratacionNuevoConvenioForm">
      <p-accordion styleClass="sivimss-accordion sivimss-accordionColor mb-5" [activeIndex]="0">
        <p-accordionTab header="Datos de la persona">
          <div formGroupName="persona">
            <app-datos-persona></app-datos-persona>
          </div>
        </p-accordionTab>
      </p-accordion>
      <p-accordion styleClass="sivimss-accordion sivimss-accordionColor mb-5" [activeIndex]="0">
        <p-accordionTab header="Características del convenio">
          <div class="row mb-3">
            <div class="col-md-4">
              <label class="control-label" for="tipoPaquete">Tipo de paquete<span class="req">*</span>:</label>
              <p-dropdown appendTo="body" id="tipoPaquete" class="form-control" formControlName="tipoPaquete"
                          [options]="paquetes" placeholder="Selecciona el tipo de paquete">
              </p-dropdown>
              <span class="campo-obligatorio"
                    *ngIf="convenioFormGroup?.tipoPaquete?.errors?.required  && (convenioFormGroup?.tipoPaquete?.dirty || convenioFormGroup?.tipoPaquete?.touched)">
      Este campo es obligatorio *.</span>
            </div>
          </div>
        </p-accordionTab>
      </p-accordion>
      <p-accordion styleClass="sivimss-accordion sivimss-accordionColor mb-5" [activeIndex]="0">
        <p-accordionTab header="Documentación requerida">
          <ng-container *ngIf="false else ErrorDocumentacion">
            <app-documentacion-beneficiario></app-documentacion-beneficiario>
          </ng-container>
        </p-accordionTab>
      </p-accordion>
      <p-accordion styleClass="sivimss-accordion sivimss-accordionColor mb-5" [activeIndex]="0">
        <p-accordionTab header="Beneficiarios">
          <ng-container formArrayName="beneficiarios">
            <ng-container *ngIf="beneficiariosPF.length > 0 else SinBeneficiarios">
              <ng-container *ngFor="let beneficiario of beneficiarios.controls; let i = index">
                <p-accordion styleClass="sivimss-accordion sivimss-accordionColor mb-5">
                  <p-accordionTab [header]="beneficiario.get('nombre')?.value" [formGroupName]="i">
                    <app-datos-beneficiario [ID]="i.toString()"></app-datos-beneficiario>
                    <p-accordion styleClass="sivimss-accordion sivimss-accordionColor mb-5" [activeIndex]="0">
                      <p-accordionTab header="Documentación requerida">
                        <ng-container *ngIf="false else ErrorDocumentacion">
                          <app-documentacion-beneficiario></app-documentacion-beneficiario>
                        </ng-container>
                      </p-accordionTab>
                    </p-accordion>
                  </p-accordionTab>
                </p-accordion>
              </ng-container>
            </ng-container>
          </ng-container>
        </p-accordionTab>
      </p-accordion>
    </form>
  </ng-container>
</ng-container>


<div class="row mt-3 mb-2">
  <div class="col-md-12 flex justify-content-end mt-6 mb-4">
    <button type="submit" class="btn btn-default btn-md" routerLink="./../../../">Cancelar</button>
    <button type="submit" class="btn btn-primary btn-md ml-5" (click)="aceptar()">Aprobar Convenio</button>
  </div>
</div>

<ng-template pTemplate="content" #SinBeneficiarios>
  <div class="row table-panel-row">
    <div class="col-md-12 mt-4">
      <p class="mensaje-cancelacion-orden font-14">El convenio no tiene beneficiarios registrados.</p>
    </div>
  </div>
</ng-template>

<ng-template pTemplate="content" #SinBeneficiarioEspecifico>
  <div class="row table-panel-row">
    <div class="col-md-12 mt-4">
      <p class="mensaje-cancelacion-orden font-14">Información de beneficiario no registrada.</p>
    </div>
  </div>
</ng-template>

<ng-template pTemplate="content" #SinSolicitantes>
  <div class="row table-panel-row">
    <div class="col-md-12 mt-4">
      <p class="mensaje-cancelacion-orden font-14">El convenio no tiene solicitantes registrados.</p>
    </div>
  </div>
</ng-template>

<ng-template pTemplate="content" #SolicitanteSinBeneficiarios>
  <div class="row table-panel-row">
    <div class="col-md-12 mt-4">
      <p class="mensaje-cancelacion-orden font-14">El solicitante no tiene beneficiarios registrados.</p>
    </div>
  </div>
</ng-template>


<ng-template pTemplate="content" #ErrorDocumentacion>
  <div class="row table-panel-row">
    <div class="col-md-12 mt-4">
      <p class="mensaje-cancelacion-orden font-14">Error al cargar la información.</p>
    </div>
  </div>
</ng-template>
