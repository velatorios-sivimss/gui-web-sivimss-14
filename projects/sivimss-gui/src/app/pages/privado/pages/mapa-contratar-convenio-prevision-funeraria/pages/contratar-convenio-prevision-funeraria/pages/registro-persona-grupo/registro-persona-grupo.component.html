<div class="container-sivimss px-5 registro-en-linea my-5">
    <app-titulo-principal titulo="REGISTRO DE PERSONA DEL GRUPO">
        <app-btn-regresar [routerLink]="['../']" [queryParams]="queryParams"></app-btn-regresar>
    </app-titulo-principal>

    <div>
        <form [formGroup]="formPersona" #formPrincipal (ngSubmit)="guardarPersona()">
            <div class="border-panel mb-5">
                <ng-container formGroupName="datosPersonales">
                    <h2 class="subtitulo-base">Datos personales</h2>
                    <div class="row mb-3">
                        <div class="col-md-3">
                            <label class="control-label" for="matricula">Matrícula:</label>
                            <input id="matricula" type="text" class="form-control" formControlName="matricula"
                                placeholder="Ingresa matrícula" maxlength="10" (blur)="consultarMatriculaSIAP()" [readonly]="readonlyInputs">
                        </div>
                        <div class="col-md-3">
                            <label class="control-label" for="rfc">R.F.C.:</label>
                            <input id="rfc" type="text" class="form-control" formControlName="rfc" (blur)="validarRFC()"
                                placeholder="Ingresa R.F.C." maxlength="13" [readonly]="readonlyInputs">
                        </div>
                        <div class="col-md-3">
                            <label class="control-label" for="curp">CURP <span class="req">*</span>:</label>
                            <input id="curp" type="text" class="form-control" formControlName="curp"
                                placeholder="Ingresa CURP" (blur)="consultarCURP()" (keyup)="convertirAMayusculas(0)"
                                [readonly]="readonlyInputs" maxlength="18">
                            <span class="campo-obligatorio"
                                *ngIf="datosPersonales.curp?.errors?.required && (datosPersonales.curp?.dirty || datosPersonales.curp?.touched)">Este
                                campo es obligatorio *.</span>
                        </div>
                        <div class="col-md-3">
                            <label class="control-label" for="nombre">Nombre <span class="req">*</span>:</label>
                            <input id="nombre" type="text" class="form-control" formControlName="nombre"
                                placeholder="Ingresa nombre" maxlength="30">
                            <span class="campo-obligatorio"
                                *ngIf="datosPersonales.nombre?.errors?.required && (datosPersonales.nombre?.dirty || datosPersonales.nombre?.touched)">Este
                                campo es obligatorio *.</span>
                        </div>
                    </div>
                    <div class="row mb-3">
                        <div class="col-md-3">
                            <label class="control-label" for="primerApellido">Primer apellido <span
                                    class="req">*</span>:</label>
                            <input id="primerApellido" type="text" class="form-control" formControlName="primerApellido"
                                placeholder="Ingresa primer apellido" maxlength="30">
                            <span class="campo-obligatorio"
                                *ngIf="datosPersonales.primerApellido?.errors?.required && (datosPersonales.primerApellido?.dirty || datosPersonales.primerApellido?.touched)">Este
                                campo es obligatorio *.</span>
                        </div>
                        <div class="col-md-3">
                            <label class="control-label" for="segundoApellido">Segundo apellido <span
                                    class="req">*</span>:</label>
                            <input id="segundoApellido" type="text" class="form-control"
                                formControlName="segundoApellido" placeholder="Ingresa segundo apellido" maxlength="30">
                            <span class="campo-obligatorio"
                                *ngIf="datosPersonales.segundoApellido?.errors?.required && (datosPersonales.segundoApellido?.dirty || datosPersonales.segundoApellido?.touched)">Este
                                campo es obligatorio *.</span>
                        </div>
                        <div class="col-md-3">
                            <label class="control-label" for="sexo">Sexo<span class="req">*</span>:</label>
                            <p-dropdown id="sexo" class="form-control" formControlName="sexo"
                                placeholder="Selecciona sexo" (onChange)="cambioTipoSexo()" [readonly]="readonlyInputs"
                                [options]="tipoSexo"></p-dropdown>
                            <span class="campo-obligatorio"
                                *ngIf="datosPersonales.sexo?.errors?.required && (datosPersonales.sexo?.dirty || datosPersonales.sexo?.touched)">Este
                                campo es obligatorio *.</span>
                        </div>
                        <div class="col-md-3" *ngIf="validaSexo">
                            <label class="control-label" for="otroSexo">Otro:</label>
                            <input id="otroSexo" class="form-control" formControlName="otroSexo"
                                placeholder="Ingresa sexo" maxlength="15" [readonly]="readonlyInputs">
                            <span class="campo-obligatorio"
                                *ngIf="datosPersonales.otroSexo?.errors?.required && (datosPersonales.otroSexo?.dirty || datosPersonales.otroSexo?.touched)">Este
                                campo es obligatorio *.</span>
                        </div>

                    </div>
                    <div class="row mb-3">
                        <div class="col-md-3">
                            <label class="control-label" for="lugarNacimiento">Lugar de nacimiento<span
                                    class="req">*</span>:</label>
                            <p-dropdown id="lugarNacimiento" class="form-control" formControlName="lugarNacimiento"
                                [readonly]="readonlyInputs" appendTo="body" placeholder="Selecciona lugar de nacimiento"
                                [options]="estado" [filter]="true" filterBy="label"></p-dropdown>

                            <span class="campo-obligatorio"
                                *ngIf="datosPersonales.lugarNacimiento?.errors?.required && (datosPersonales.lugarNacimiento?.dirty || datosPersonales.lugarNacimiento?.touched)">Este
                                campo es obligatorio *.</span>
                        </div>
                        <div class="col-md-3">
                            <label class="control-label" for="fechaNacimiento">Fecha de nacimiento<span
                                    class="req">*</span>:</label>
                            <input id="fechaNacimiento" type="text" class="form-control" [readonly]="readonlyInputs"
                                formControlName="fechaNacimiento" placeholder="Ingresa municipio">
                        </div>
                    </div>
                </ng-container>
                <ng-container formGroupName="domicilio">
                    <h2 class="subtitulo-base">Domicilio</h2>
                    <div class="row mb-3">
                        <div class="col-md-3">
                            <label class="control-label" for="codigoPostal">C.P. <span class="req">*</span>:</label>
                            <input id="codigoPostal" type="text" class="form-control" formControlName="codigoPostal"
                                (change)="buscarCodigoPostal()" placeholder="Ingresa código postal" numbersOnly maxlength="5"
                                [readonly]="readonlyInputs">
                            <span class="campo-obligatorio"
                                *ngIf="domicilio.codigoPostal?.errors?.required && (domicilio.codigoPostal?.dirty || domicilio.codigoPostal?.touched)">Este
                                campo es obligatorio *.</span>
                        </div>
                        <div class="col-md-3">
                            <label class="control-label" for="asentamientoColonia">Asentamiento / Colonia <span
                                    class="req">*</span>:</label>
                            <p-dropdown id="asentamientoColonia" class="form-control" [readonly]="readonlyInputs"
                                formControlName="asentamientoColonia" appendTo="body" placeholder="Selecciona colonia"
                                [options]="colonias" [filter]="true" filterBy="label"></p-dropdown>
                            <span class="campo-obligatorio"
                                *ngIf="domicilio.asentamientoColonia?.errors?.required && (domicilio.asentamientoColonia?.dirty || domicilio.asentamientoColonia?.touched)">Este
                                campo es obligatorio *.</span>
                        </div>
                        <div class="col-md-3">
                            <label class="control-label" for="municipio">Municipio <span class="req">*</span>:</label>
                            <input id="municipio" type="text" class="form-control" formControlName="municipio"
                                placeholder="Ingresa municipio">
                            <span class="campo-obligatorio"
                                *ngIf="domicilio.municipio?.errors?.required && (domicilio.municipio?.dirty || domicilio.municipio?.touched)">Este
                                campo es obligatorio *.</span>
                        </div>
                        <div class="col-md-3">
                            <label class="control-label" for="estado">Estado <span class="req">*</span>:</label>
                            <input id="estado" type="text" class="form-control" formControlName="estado"
                                placeholder="Ingresa otro">

                            <span class="campo-obligatorio"
                                *ngIf="domicilio.estado?.errors?.required && (domicilio.estado?.dirty || domicilio.estado?.touched)">Este
                                campo es obligatorio *.</span>
                        </div>
                    </div>
                    <div class="row mb-3">
                        <div class="col-md-3">
                            <label class="control-label" for="pais">País <span class="req">*</span>:</label>
                            <p-dropdown id="pais" class="form-control" formControlName="pais" appendTo="body"
                                placeholder="Selecciona país" [options]="paises" [filter]="true"
                                [readonly]="readonlyInputs" filterBy="label"></p-dropdown>
                            <span class="campo-obligatorio"
                                *ngIf="domicilio.pais?.errors?.required && (domicilio.pais?.dirty || domicilio.pais?.touched)">Este
                                campo es obligatorio *.</span>
                        </div>
                        <div class="col-md-3">
                            <label class="control-label" for="calle">Calle <span class="req">*</span>:</label>
                            <input id="calle" type="text" class="form-control" formControlName="calle" maxlength="30"
                                [readonly]="readonlyInputs" placeholder="Ingresa calle">
                            <span class="campo-obligatorio"
                                *ngIf="domicilio.calle?.errors?.required && (domicilio.calle?.dirty || domicilio.calle?.touched)">Este
                                campo es obligatorio *.</span>
                        </div>
                        <div class="col-md-3">
                            <label class="control-label" for="numeroExterior">Número exterior <span
                                    class="req">*</span>:</label>
                            <input id="numeroExterior" type="text" class="form-control" formControlName="numeroExterior"
                                [readonly]="readonlyInputs" placeholder="Ingresa número exterior" maxlength="5">
                            <span class="campo-obligatorio"
                                *ngIf="domicilio.numeroExterior?.errors?.required && (domicilio.numeroExterior?.dirty || domicilio.numeroExterior?.touched)">Este
                                campo es obligatorio *.</span>
                        </div>
                        <div class="col-md-3">
                            <label class="control-label" for="numeroInterior">Número interior:</label>
                            <input id="numeroInterior" type="text" class="form-control" formControlName="numeroInterior"
                                [readonly]="readonlyInputs" placeholder="Ingresa número interior" maxlength="4">
                        </div>
                    </div>
                    <div class="row mb-3">
                        <div class="col-md-3">
                            <label class="control-label" for="correoElectronico">Correo electrónico <span
                                    class="req">*</span>:</label>
                            <input id="correoElectronico" type="text" class="form-control" maxlength="45" (blur)="validarCorreo()"
                                formControlName="correoElectronico" placeholder="Ingresa correo electrónico"
                                [readonly]="readonlyInputs">
                            <span class="campo-obligatorio"
                                *ngIf="domicilio.correoElectronico?.errors?.required && (domicilio.correoElectronico?.dirty || domicilio.correoElectronico?.touched)">Este
                                campo es obligatorio *.</span>
                        </div>
                        <div class="col-md-3">
                            <label class="control-label" for="telefono">Teléfono <span class="req">*</span>:</label>
                            <input id="telefono" type="text" class="form-control" formControlName="telefono" numbersOnly maxlength="10"
                                [readonly]="readonlyInputs" placeholder="Ingresa teléfono">
                            <span class="campo-obligatorio"
                                *ngIf="domicilio.telefono?.errors?.required && (domicilio.telefono?.dirty || domicilio.telefono?.touched)">Este
                                campo es obligatorio *.</span>
                        </div>
                        <div class="col-md-3">
                            <label class="control-label" for="enfermedadPrexistente">Enfermedad prexistente:</label>
                            <p-dropdown id="enfermedadPrexistente" class="form-control"
                                formControlName="enfermedadPrexistente" appendTo="body" [readonly]="readonlyInputs"
                                placeholder="Selecciona enfermedad prexistente" (onChange)="cambioEnfermedadPrexistente()"
                                [options]="enfermedadPrexistenteArray" [filter]="true" filterBy="label"></p-dropdown>
                        </div>
                        <div class="col-md-3" *ngIf="muestraOtraEnfermedad">
                            <label class="control-label" for="otro">Otro:</label>
                            <input id="otro" type="text" class="form-control" formControlName="otro"
                                [readonly]="readonlyInputs" placeholder="Ingresa otro" maxlength="45">
                        </div>
                    </div>
                </ng-container>
            </div>

            <div class="border-panel mb-5">
              <div class="flex justify-content-between align-items-center">
                <h2 class="subtitulo-base">Beneficiarios</h2>
                <button class="btn btn-default btn-md ml-5" (click)="abrirModalRegistroNuevoBeneficiario($event)"
                    *ngIf="(beneficiarios.length < 3) && mostrarBotonAgregarBeneficiario" type="button">Nuevo
                    beneficiario</button>
              </div>
                <p-table styleClass="mt-5 mb-8" [value]="beneficiarios" [resizableColumns]="true"
                    [columnResizeMode]="'expand'">
                    <ng-template pTemplate="header">
                        <tr>
                            <th scope="col">Velatorio</th>
                            <th scope="col">Fecha</th>
                            <th scope="col">Nombre</th>
                            <th scope="col">Primer apellido</th>
                            <th scope="col">Segundo apellido</th>
                            <th scope="col">Edad</th>
                            <th scope="col">Parentesco</th>
                            <th scope="col">CURP</th>
                            <th scope="col">RFC</th>
                            <th scope="col">Acta nacimiento</th>
                            <th scope="col">Correo electrónico</th>
                            <th scope="col">Teléfono</th>
                            <th scope="col" style="width: 40px; border-left: 1px solid #b0b0b0;"></th>
                        </tr>
                    </ng-template>
                    <ng-template pTemplate="body" let-beneficiarios>
                        <tr>
                            <td>{{beneficiarios.velatorio }}</td>
                            <td>{{beneficiarios.fechaNacimiento}}</td>
                            <td>{{beneficiarios.nombreAfiliado}}</td>
                            <td>{{beneficiarios.primerApellido}}</td>
                            <td>{{beneficiarios.segundoApellido}}</td>
                            <td>{{beneficiarios.edad}}</td>
                            <td>{{beneficiarios.parentesco}}</td>
                            <td>{{beneficiarios.curp}}</td>
                            <td>{{beneficiarios.rfc}}</td>
                            <td>{{beneficiarios.ine}}</td>
                            <td>{{beneficiarios.correo}}</td>
                            <td>{{beneficiarios.telefono}}</td>
                            <td style="border-left: 1px solid #b0b0b0;">
                                <div class="contenedor-celda-iconos">
                                    <a (click)="abrirPanel($event,beneficiarios)" onCloseOnNavigation>
                                        <i class="pi pi-ellipsis-v"></i>
                                    </a>
                                </div>
                            </td>
                    </ng-template>
                </p-table>
            </div>

            <div class="border-panel mb-5">
                <h2 class="subtitulo-base">Paquetes</h2>
                <ng-container formGroupName="formPaquete">
                    <div class="paquetes">
                        <div class="paquete" *ngFor="let item of paquetes; let i = index">
                            <div class="paquete-titulo">
                              <p-radioButton [inputId]="'item.idPaquete'" name="paquete" [value]="item.idPaquete"  formControlName="paquete"
                                             (click)="seleccionaPaquete(item.idPaquete)"></p-radioButton>
                                <span>{{item.nomPaquete}}</span>
                            </div>
                            <div>
                                <ul>
                                    <li *ngFor="let contenido of item.serviciosPaquetes;">{{contenido}}
                                    </li>
                                </ul>
                                <div class="iconos">
                                    <img alt="candle1" src="assets/images/sivimss-externos/material-symbols_candle.svg">
                                    <img alt="candle2" src='{{ "assets/images/sivimss-externos/material-symbols_candle" + (i > 0 ? "" : "-2") + ".svg" }}'>
                                    <img alt="candle3" src='{{ "assets/images/sivimss-externos/material-symbols_candle" + (i > 1 ? "" : "-2") + ".svg" }}'>
                                </div>
                            </div>
                        </div>
                    </div>
                </ng-container>
            </div>





            <div class="border-panel mb-5" formGroupName="archivos">
                <div class="row mb-5">
                    <div class="col-md-2 flex flex-column">
                        <span class="etiqueta-base font-bold">Folio único del convenio</span>
                        <span class="texto-base font-normal">{{folioConvenio}}</span>
                    </div>
                    <div class="col-md-3 flex flex-column">
                        <span class="etiqueta-base font-bold">Nombre completo</span>
                        <span class="texto-base font-normal">{{nombreCompleto}}</span>
                    </div>
                    <div class="col-md-3 flex flex-column">
                        <span class="etiqueta-base font-bold">Delegación</span>
                        <span class="texto-base font-normal">{{delegacion}}</span>
                    </div>
                    <div class="col-md-2 flex flex-column">
                        <span class="etiqueta-base font-bold">Velatorio</span>
                        <span class="texto-base font-normal">{{velatorio}}</span>
                    </div>
                    <div class="col-md-2 flex flex-column">
                        <span class="etiqueta-base font-bold">Fecha</span>
                        <span class="texto-base font-normal">{{fecha| date:'dd-mm-yyyy'}}</span>
                    </div>
                </div>
                <div class="row mb-8">
                    <div class="col-md-2">
                        <label class="control-label" for="curp">Copia INE<span class="req">*</span>:</label>
                        <div (click)="handleClick('archivoIneUpload')" class="file-container">
                            <input class="hidden" type="file" id="archivoIneUpload" name="archivoIneUpload"
                                [readonly]="readonlyInputs" accept=".jpg, .jpeg, .png, .pdf" ngf-max-size="5MB"
                                (change)="addAttachment($event)">
                            <input id="archivoIne" class="form-control" formControlName="archivoIne" readonly>
                            <img src="assets/images/imagen-icono-file-upload.svg" class="ms" alt="icono ver">
                        </div>
                    </div>
                    <div class="col-md-2">
                        <label class="control-label" for="curp">Copia CURP<span class="req">*</span>:</label>
                        <div (click)="handleClick('archivoCURPUpload')" class="file-container">
                            <input class="hidden" type="file" id="archivoCURPUpload" name="archivoCURPUpload"
                                [readonly]="readonlyInputs" accept=".jpg, .jpeg, .png, .pdf" ngf-max-size="5MB"
                                (change)="addAttachment($event)">
                            <input id="archivoCurp" class="form-control" formControlName="archivoCurp" readonly>
                            <img src="assets/images/imagen-icono-file-upload.svg" class="ms" alt="icono ver">
                        </div>
                    </div>

                    <div class="col-md-2">
                        <label class="control-label" for="rfc">Copia RFC<span class="req">*</span>:</label>
                        <div (click)="handleClick('archivoRFCUpload')" class="file-container">
                            <input class="hidden" type="file" id="archivoRFCUpload" name="archivoRFCUpload"
                                [readonly]="readonlyInputs" accept=".jpg, .jpeg, .png, .pdf" ngf-max-size="5MB"
                                (change)="addAttachment($event)">
                            <input id="archivoRfc" class="form-control" formControlName="archivoRfc" readonly>
                            <img src="assets/images/imagen-icono-file-upload.svg" class="ms" alt="icono ver">
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-12">
                        <ul>
                            <li class="text-archivos">
                                Arrastrar y soltar los archivos en la sección "Cargar Archivos" o selecciona la
                                opción “Agregar
                                Archivo".
                            </li>
                            <li class="text-archivos">Subir archivos con formato PDF y/o imágenes: gif, jpeg y jpg.
                                Si tienes dudas
                                puedes asistir a tu Velatorio más cercano.</li>
                        </ul>
                    </div>
                </div>
            </div>

            <div class="mt-3 mb-3">
                <span class="texto-base font-normal">*Campos obligatorios</span>
            </div>
            <div class="row">
                <div class="col-md-12 flex justify-content-end align-items-center">
                    <button class="btn btn-gold btn-md" type="button">Cancelar</button>
                    <button class="btn btn-primary btn-md ml-4" type="submit" [disabled]="!this.formPersona.valid"
                        *ngIf="mostrarBontonGaurdarPersona">Guardar</button>
                    <button class="btn ml-4 btn-gold btn-md" (click)="regresarPantalla()" type="button" *ngIf="!mostrarBontonGaurdarPersona">Terminar
                        contratación</button>
                </div>
            </div>
        </form>
        <p-overlayPanel #overlayPanel [appendTo]="formPrincipal">
            <ng-template pTemplate="content">
                <app-overlay-panel-opciones>
                    <app-overlay-panel-opcion titulo="Editar" (click)="abrirModalEditarBeneficiario($event)">
                    </app-overlay-panel-opcion>
                    <app-overlay-panel-opcion titulo="Desactivar" (click)="abrirModalDesactivarBeneficiario($event)">
                    </app-overlay-panel-opcion>
                </app-overlay-panel-opciones>
            </ng-template>
        </p-overlayPanel>
    </div>
</div>
<p-dialog [(visible)]="mostrarMensajeGenerico" [modal]="true"
          [style]="{maxWidth:'544px',width: '100%'}" [closable]="true" [draggable]="false" [resizable]="false"
          header="Carga de archivos" [showHeader]="true">
  <ng-template pTemplate="content">
    <div>
      <p class="mt-2 text-center">{{mensajeGenerico}}</p>
    </div>
  </ng-template>
  <ng-template pTemplate="footer">
    <div class="flex justify-content-center">
      <button class="btn btn-primary btn-md ml-4" (click)="mostrarMensajeGenerico = false">Aceptar</button>
    </div>
  </ng-template>
</p-dialog>
